<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <script src="https://testflex.cybersource.com/microform/bundle/v2/flex-microform.min.js"></script>
</head>

<body>

  <h1>Checkout</h1>
  <div id="errors-output" role="alert"></div>
  <form action="/token" id="my-sample-form" method="post">
    <div class="form-group">
      <label for="cardholderName">Name</label>
      <input id="cardholderName" class="form-control" name="cardholderName" placeholder="Name on the card">
      <label id="cardNumber-label">Card Number</label>
      <div id="number-container" class="form-control"></div>
      <label for="securityCode-container">Security Code</label>
      <div id="securityCode-container" class="form-control"></div>
    </div>

    <div class="form-row">
      <div class="form-group col-md-6">
        <label for="expMonth">Expiry month</label>
        <select id="expMonth" class="form-control">
          <option>12</option>
        </select>
      </div>
      <div class="form-group col-md-6">
        <label for="expYear">Expiry year</label>
        <select id="expYear" class="form-control">
          <option>2031</option>
        </select>
      </div>
    </div>

    <button type="button" id="pay-button" class="btn btn-primary">Pay</button>
    <input type="hidden" id="flexresponse" name="flexresponse">
  </form>
  <script>
    // constiables from the HTML form
    const form = document.querySelector('#my-sample-form');
    const payButton = document.querySelector('#pay-button');
    const flexResponse = document.querySelector('#flexresponse');
    const expMonth = document.querySelector('#expMonth');
    const expYear = document.querySelector('#expYear');
    const errorsOutput = document.querySelector('#errors-output');

    // the capture context that was requested server-side for this transaction
    const captureContext = 'eyJraWQiOiJ6dSIsImFsZyI6IlJTMjU2In0.eyJmbHgiOnsicGF0aCI6Ii9mbGV4L3YyL3Rva2VucyIsImRhdGEiOiJqWVlnckYyL0tMejBDN1pkeU9VTDJCQUFFQm5GYVMrUzJadlRwZWk5U1U4QVZNNkllQm5jRTNpN2N3SzZUN0NVRnFuMXRwbVA1aWtHWHB0NCtkMVQzekhPU3lCQ1c3aTJlM3lXdzVvcjFYc1orREdPb0poc0NYR3I2cVFhS2FYcHM2Q08iLCJvcmlnaW4iOiJodHRwczovL3Rlc3RmbGV4LmN5YmVyc291cmNlLmNvbSIsImp3ayI6eyJrdHkiOiJSU0EiLCJlIjoiQVFBQiIsInVzZSI6ImVuYyIsIm4iOiJteGlYVlhVNER0anM4MDdTXzhvZEhjelhtaEhiYVJnQmk3RTVIeHNTNjJudHNmTnZmcVBoTWR4MUZPZ1g3MzVyYnRfNy1yZWwwUjZhQ0FSTU1UNHFZVkdzWldLVWRxSWZhTzVFeWVqY3A4TnA4REt4QnRTaUpzaHFKemd4UzN0cE92c0taYU93V2ZXNjFpb2M5NVFKT2x4cVlYdFRkSFVzSDU5M3dQNXJMeUV4c1gyQ240NTZKQ2hvRS1mWkNRNDNfNjRvVHE5aHdoMElyRndkcnM1RWpDMy1GQXlZc2VCR2s5cDY4Z2cwUmh0bVROak5vQXRrRURMWVZ5MDNXTXVjTnNYWFpqRVE3YnlEaXowREZzWE9ydUdJUDlhSS05VXBjczhuWUMyZHRGcWJtSmRVaFdVX21CSHpoVERNbnd5ZHNCd283UjhtWDFfQTVZUnBmQlhkUFEiLCJraWQiOiIwN2lYaEhPclU0WENidDVtbkw1NzAwb3VNeGRrRHNoZiJ9fSwiY3R4IjpbeyJkYXRhIjp7ImNsaWVudExpYnJhcnkiOiJodHRwczovL3Rlc3RmbGV4LmN5YmVyc291cmNlLmNvbS9taWNyb2Zvcm0vYnVuZGxlL3YyLjAvZmxleC1taWNyb2Zvcm0ubWluLmpzIiwiYWxsb3dlZENhcmROZXR3b3JrcyI6WyJWSVNBIiwiTUFTVEVSQ0FSRCIsIkFNRVgiXSwidGFyZ2V0T3JpZ2lucyI6WyJodHRwOi8vbG9jYWxob3N0OjU1MDAiXSwibWZPcmlnaW4iOiJodHRwczovL3Rlc3RmbGV4LmN5YmVyc291cmNlLmNvbSJ9LCJ0eXBlIjoibWYtMi4wLjAifV0sImlzcyI6IkZsZXggQVBJIiwiZXhwIjoxNzExNTU0ODA4LCJpYXQiOjE3MTE1NTM5MDgsImp0aSI6IjRxT1llOEQzdHBtbnpVcGgifQ.jSReKHgigfNXlXZ-y6R-WUKV6Wsr1UCMo5ZVYct_ZnDEeOo9Im-WajHQ_Zh6n77CoS9fUVjibR0ipXHJjQ0yds9JVwzRRTseGq5GrAqVUzR4VYZUJQwJq-39qBccv-eXrny16x_nuuS7DNN_ECgPdopo_Wr60CZiVhC1ApDSnCuN828qTQ0eJROPEznQnKUsWrcaPFm0gQH0FIqZOW4gBiwjKKuhhU1RB-us2mh5uFLxqi81HA7UgOB3mDFsDYXeT0RSdeqdZDWrZWRpci4wgNrrfuNsVLoExBgNGiXctZ4IRD-L3e3WpUwTctbAT40wwm0hc6wm-IKqxtIwVCYmBw'
    // custom styles that will be applied to each field we create using Microform
    const myStyles = {
      'input': {
        'font-size': '14px',
        'font-family': 'helvetica, tahoma, calibri, sans-serif',
        'color': '#555'
      },
      ':focus': { 'color': 'blue' },
      ':disabled': { 'cursor': 'not-allowed' },
      'valid': { 'color': '#3c763d' },
      'invalid': { 'color': '#a94442' }
    };
    // setup Microform
    const flex = new Flex(captureContext);
    const microform = flex.microform({ styles: myStyles });
    const number = microform.createField('number', { placeholder: 'Enter card number' });
    const securityCode = microform.createField('securityCode', { placeholder: '•••' });
    number.load('#number-container');
    securityCode.load('#securityCode-container');


    // Configuring a Listener for the Pay button
    payButton.addEventListener('click', function() {

    // Compiling MM & YY into optional paramiters
      const options = {
        expirationMonth: document.querySelector('#expMonth').value,
        expirationYear: document.querySelector('#expYear').value
      };
    //
      microform.createToken(options, function (err, token) {
        if (err) {
          // handle error
          console.error(err);
          errorsOutput.textContent = err.message;
        } else {
          // At this point you may pass the token back to your server as you wish.
          // In this example we append a hidden input to the form and submit it.
          console.log(JSON.stringify(token));
          flexResponse.value = JSON.stringify(token);
          // form.submit();
          console.log(form)
        }
      });
    });
  </script>
</body>

</html>

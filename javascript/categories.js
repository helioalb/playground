const response = {
	"data": [
		{
			"id": "8",
			"type": "taxon",
			"attributes": {
				"name": "Oral",
				"pretty_name": "Categorias -> Medicamentos -> Oral",
				"permalink": "categorias/medicamentos/oral",
				"seo_title": "Oral",
				"description": null,
				"meta_title": null,
				"meta_description": null,
				"meta_keywords": null,
				"left": 7,
				"right": 10,
				"position": 0,
				"depth": 2,
				"updated_at": "2024-06-22T08:35:05.823-05:00",
				"public_metadata": {},
				"is_root": false,
				"is_child": true,
				"is_leaf": false,
				"localized_slugs": {
					"en": "categorias/medicamentos/oral"
				}
			},
			"relationships": {
				"parent": {
					"data": {
						"id": "5",
						"type": "taxon"
					}
				},
				"taxonomy": {
					"data": {
						"id": "1",
						"type": "taxonomy"
					}
				},
				"children": {
					"data": [
						{
							"id": "9",
							"type": "taxon"
						}
					]
				},
				"image": {
					"data": null
				}
			}
		},
		{
			"id": "5",
			"type": "taxon",
			"attributes": {
				"name": "Medicamentos",
				"pretty_name": "Categorias -> Medicamentos",
				"permalink": "categorias/medicamentos",
				"seo_title": "medicamentos",
				"description": "<p>Uma descri&ccedil;&atilde;o para medicamentos</p>",
				"meta_title": "medicamentos",
				"meta_description": "medicamentos",
				"meta_keywords": "medicamentos",
				"left": 2,
				"right": 11,
				"position": 0,
				"depth": 1,
				"updated_at": "2024-06-22T08:35:05.823-05:00",
				"public_metadata": {},
				"is_root": false,
				"is_child": true,
				"is_leaf": false,
				"localized_slugs": {
					"en": "categorias/medicamentos"
				}
			},
			"relationships": {
				"parent": {
					"data": {
						"id": "1",
						"type": "taxon"
					}
				},
				"taxonomy": {
					"data": {
						"id": "1",
						"type": "taxonomy"
					}
				},
				"children": {
					"data": [
						{
							"id": "6",
							"type": "taxon"
						},
						{
							"id": "8",
							"type": "taxon"
						}
					]
				},
				"image": {
					"data": null
				}
			}
		},
		{
			"id": "6",
			"type": "taxon",
			"attributes": {
				"name": "Pele",
				"pretty_name": "Categorias -> Medicamentos -> Pele",
				"permalink": "categorias/medicamentos/pele",
				"seo_title": "Pele",
				"description": null,
				"meta_title": "",
				"meta_description": "",
				"meta_keywords": "",
				"left": 3,
				"right": 6,
				"position": 0,
				"depth": 2,
				"updated_at": "2024-06-22T08:35:05.761-05:00",
				"public_metadata": {},
				"is_root": false,
				"is_child": true,
				"is_leaf": false,
				"localized_slugs": {
					"en": "categorias/medicamentos/pele"
				}
			},
			"relationships": {
				"parent": {
					"data": {
						"id": "5",
						"type": "taxon"
					}
				},
				"taxonomy": {
					"data": {
						"id": "1",
						"type": "taxonomy"
					}
				},
				"children": {
					"data": [
						{
							"id": "7",
							"type": "taxon"
						}
					]
				},
				"image": {
					"data": null
				}
			}
		},
		{
			"id": "1",
			"type": "taxon",
			"attributes": {
				"name": "Categorias",
				"pretty_name": "Categorias",
				"permalink": "categorias",
				"seo_title": "Categorias",
				"description": "<p>Pai de todos</p>",
				"meta_title": "",
				"meta_description": "",
				"meta_keywords": "",
				"left": 1,
				"right": 12,
				"position": 0,
				"depth": 0,
				"updated_at": "2024-06-22T08:35:05.823-05:00",
				"public_metadata": {},
				"is_root": true,
				"is_child": false,
				"is_leaf": false,
				"localized_slugs": {
					"en": "categorias"
				}
			},
			"relationships": {
				"parent": {
					"data": null
				},
				"taxonomy": {
					"data": {
						"id": "1",
						"type": "taxonomy"
					}
				},
				"children": {
					"data": [
						{
							"id": "5",
							"type": "taxon"
						}
					]
				},
				"image": {
					"data": null
				}
			}
		},
		{
			"id": "9",
			"type": "taxon",
			"attributes": {
				"name": "Fungos",
				"pretty_name": "Categorias -> Medicamentos -> Oral -> Fungos",
				"permalink": "categorias/medicamentos/oral/fungos",
				"seo_title": "Fungos",
				"description": null,
				"meta_title": null,
				"meta_description": null,
				"meta_keywords": null,
				"left": 8,
				"right": 9,
				"position": 0,
				"depth": 3,
				"updated_at": "2024-06-22T08:35:05.812-05:00",
				"public_metadata": {},
				"is_root": false,
				"is_child": true,
				"is_leaf": true,
				"localized_slugs": {
					"en": "categorias/medicamentos/oral/fungos"
				}
			},
			"relationships": {
				"parent": {
					"data": {
						"id": "8",
						"type": "taxon"
					}
				},
				"taxonomy": {
					"data": {
						"id": "1",
						"type": "taxonomy"
					}
				},
				"children": {
					"data": []
				},
				"image": {
					"data": null
				}
			}
		},
		{
			"id": "7",
			"type": "taxon",
			"attributes": {
				"name": "Fungos",
				"pretty_name": "Categorias -> Medicamentos -> Pele -> Fungos",
				"permalink": "categorias/medicamentos/pele/fungos",
				"seo_title": "Fungos",
				"description": null,
				"meta_title": null,
				"meta_description": null,
				"meta_keywords": null,
				"left": 4,
				"right": 5,
				"position": 0,
				"depth": 3,
				"updated_at": "2024-06-22T08:35:05.750-05:00",
				"public_metadata": {},
				"is_root": false,
				"is_child": true,
				"is_leaf": true,
				"localized_slugs": {
					"en": "categorias/medicamentos/pele/fungos"
				}
			},
			"relationships": {
				"parent": {
					"data": {
						"id": "6",
						"type": "taxon"
					}
				},
				"taxonomy": {
					"data": {
						"id": "1",
						"type": "taxonomy"
					}
				},
				"children": {
					"data": []
				},
				"image": {
					"data": null
				}
			}
		}
	],
	"meta": {
		"count": 6,
		"total_count": 6,
		"total_pages": 1
	},
	"links": {
		"self": "http://localhost:4000/api/v2/storefront/taxons",
		"next": "http://localhost:4000/api/v2/storefront/taxons?page=1",
		"prev": "http://localhost:4000/api/v2/storefront/taxons?page=1",
		"last": "http://localhost:4000/api/v2/storefront/taxons?page=1",
		"first": "http://localhost:4000/api/v2/storefront/taxons?page=1"
	}
}

const parent = response.data.find(taxon => taxon.attributes.is_root);


function buildCatetoryTree(taxons, parent) {
  const children = taxons.filter(taxon => taxon.relationships.parent.data?.id === parent.id);
  return children.map(child => {
    return {
      ...child,
      children: buildCatetoryTree(taxons, child)
    }
  });
}

const tree = buildCatetoryTree(response.data, parent);

const simplifyTree = (tree) => {
  return tree.map(node => {
    return {
      name: node.attributes.name,
      permalink: node.attributes.permalink,
      children: simplifyTree(node.children)
    }
  });
}

console.log(JSON.stringify(simplifyTree(tree)));
